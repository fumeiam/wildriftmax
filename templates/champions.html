<!DOCTYPE html>
<html>
<head>
  <title>Wild Rift Champion Stats</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<h2>Champion Stats</h2>

<!-- CONTROLS -->
<div class="filters">
  <label>
    Server:
    <select id="serverSelect">
      <option value="SEA">SEA</option>
      <option value="EU">EU</option>
      <option value="NA">NA</option>
    </select>
  </label>

  <label>
    Role:
    <select id="roleSelect">
      <option value="ALL">All Roles</option>
      <option value="Baron">Baron</option>
      <option value="Jungle">Jungle</option>
      <option value="Mid">Mid</option>
      <option value="Dragon">Dragon</option>
      <option value="Support">Support</option>
    </select>
  </label>

  <label>
    Patch:
    <select id="patchSelect"></select>
  </label>
</div>

<div id="champList" class="champ-list"></div>

<script>
const champions = {{ champions | tojson }};
const ROLE_ICON = {{ role_icon | tojson }};
const CURRENT_PATCH = "{{ current_patch }}";
const SERVERS = ["SEA","EU","NA"];

let currentServer = "SEA";
let currentRole = "ALL";
let selectedPatch = null;

/* ---------- HELPERS ---------- */

function avg(nums) {
  return (nums.reduce((a,b)=>a+b,0) / nums.length).toFixed(1);
}

function getPatches(champ) {
  const role = champ.roles[0];
  return Object.keys(champ.stats[role]).sort().reverse();
}

function buildPatchDropdown() {
  const patches = new Set();
  champions.forEach(c => {
    Object.values(c.stats).forEach(r =>
      Object.keys(r).forEach(p => patches.add(p))
    );
  });
  const list = Array.from(patches).sort().reverse();
  const sel = document.getElementById("patchSelect");
  list.forEach(p => {
    const opt = document.createElement("option");
    opt.value = p;
    opt.textContent = p === CURRENT_PATCH ? `${p} (Latest)` : p;
    sel.appendChild(opt);
  });
  selectedPatch = list.find(p => p !== CURRENT_PATCH) || CURRENT_PATCH;
  sel.value = selectedPatch;
}

function serverWR(champ) {
  if (currentRole !== "ALL") {
    return champ.stats[currentRole][CURRENT_PATCH][currentServer].wr;
  }
  return avg(
    champ.roles.map(r => champ.stats[r][CURRENT_PATCH][currentServer].wr)
  );
}

function overallWR(champ, patch) {
  if (currentRole !== "ALL") {
    return avg(
      SERVERS.map(s => champ.stats[currentRole][patch][s].wr)
    );
  }
  return avg(
    champ.roles.map(r =>
      avg(SERVERS.map(s => champ.stats[r][patch][s].wr))
    )
  );
}

function bestRoleForServer(champ, patch) {
  let best = champ.roles[0];
  let bestWR = -1;
  champ.roles.forEach(r => {
    const wr = champ.stats[r][patch][currentServer].wr;
    if (wr > bestWR) {
      bestWR = wr;
      best = r;
    }
  });
  return best;
}

/* ---------- RENDER ---------- */

function render() {
  const list = document.getElementById("champList");
  list.innerHTML = "";

  let filtered = champions.filter(c => {
    if (currentRole === "ALL") return true;
    return c.roles.includes(currentRole);
  });

  filtered.sort((a,b) => serverWR(b) - serverWR(a));

  filtered.forEach(c => {
    const roleIcons = c.roles.map(r =>
      `<img src="${ROLE_ICON[r]}" title="${r}" style="height:18px;margin-right:4px;">`
    ).join("");

    const curRole = currentRole === "ALL"
      ? bestRoleForServer(c, CURRENT_PATCH)
      : currentRole;

    const prevRole = currentRole === "ALL"
      ? bestRoleForServer(c, selectedPatch)
      : currentRole;

    const curStats = c.stats[curRole][CURRENT_PATCH][currentServer];
    const prevStats = c.stats[prevRole][selectedPatch][currentServer];

    list.insertAdjacentHTML("beforeend", `
      <div class="champ-card">
         
        <!-- Champion -->
        <div>
          <div class="champ-id">
            <img src="${c.icon}">
            <div>
              <div class="champ-name">${c.name}</div>
              <div class="champ-roles">
                ${roleIcons}
              </div>
            </div>
          </div>
        </div>
         
        <!-- Server WR -->
        <div class="stat">
          <div class="stat-label">Server WR</div>
          <div class="stat-value ${serverWR(c) >= 50 ? 'wr-good' : 'wr-bad'}">
            ${serverWR(c)}%
          </div>
        </div>
           
        <!-- Overall WR -->
        <div class="stat">
          <div class="stat-label">Overall WR</div>
          <div class="stat-value">
            ${overallWR(c, CURRENT_PATCH)}%
          </div>
        </div>
         
        <!-- Previous Patch WR -->
        <div class="stat">
          <div class="stat-label">Prev Patch WR</div>
          <div class="stat-value">
            ${overallWR(c, selectedPatch)}%
          </div>
        </div>
            
        <!-- Rank #1 -->
        <div class="stat">
          <div class="stat-label">Rank #1</div>
          <div class="stat-value">
            ${curStats.rank1}
          </div>
        </div>
              
        <!-- Max Points -->
        <div class="stat">
          <div class="stat-label">Max Points</div>
          <div class="stat-value">
            ${curStats.points}
          </div>
        </div>

        <!-- Previous Rank -->
        <div class="stat">
          <div class="stat-label">Prev Rank #1</div>
          <div class="stat-value">
            ${prevStats.rank1}
          </div>
        </div>

        <!-- Previous Points -->
        <div class="stat">
          <div class="stat-label">Prev Max Pts</div>
          <div class="stat-value">
            ${prevStats.points}
          </div>
        </div>
         
      </div>
    `);
  });
}

/* ---------- EVENTS ---------- */

document.getElementById("serverSelect").onchange = e => {
  currentServer = e.target.value;
  render();
};
document.getElementById("roleSelect").onchange = e => {
  currentRole = e.target.value;
  render();
};
document.getElementById("patchSelect").onchange = e => {
  selectedPatch = e.target.value;
  render();
};

/* ---------- INIT ---------- */

buildPatchDropdown();
render();
</script>

</body>
</html>






