<!DOCTYPE html>
<html>
<head>
  <title>Champions</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<nav style="margin-bottom:16px;">
  <strong>Champions</strong>
</nav>

<div style="display:flex; gap:12px; margin-bottom:12px;">
  <label>
    Server:
    <select id="serverSelect">
      <option value="SEA">SEA</option>
      <option value="EU">EU</option>
      <option value="NA">NA</option>
    </select>
  </label>

  <label>
    Role:
    <select id="roleSelect">
      <option value="ALL">All Roles</option>
      <option value="Baron">Baron</option>
      <option value="Jungle">Jungle</option>
      <option value="Mid">Mid</option>
      <option value="Dragon">Dragon</option>
      <option value="Support">Support</option>
    </select>
  </label>
</div>

<table>
  <thead>
    <tr>
      <th>Champion</th>
      <th>Roles</th>
      <th>Server WR</th>
      <th>Rank #1</th>
      <th>Max Points</th>
    </tr>
  </thead>
  <tbody id="champTable"></tbody>
</table>

<script>
const champions = {{ champions | tojson }};
const ROLE_ICON = {{ role_icon | tojson }};

let currentServer = "SEA";
let currentRole = "ALL";

function getRoleForDisplay(champ) {
  if (currentRole === "ALL") return champ.roles[0]; // primary role
  return currentRole;
}

function renderTable() {
  const tbody = document.getElementById("champTable");
  tbody.innerHTML = "";

  // filter
  let filtered = champions.filter(c => {
    if (currentRole === "ALL") return true;
    return c.roles.includes(currentRole);
  });

  // map to display stats
  let rows = filtered.map(c => {
    const role = getRoleForDisplay(c);
    const s = c.stats[role]?.[currentServer];
    if (!s) return null;
    return { champ: c, role, stat: s };
  }).filter(Boolean);

  // sort by WR desc
  rows.sort((a,b) => b.stat.wr - a.stat.wr);

  // render
  rows.forEach(({champ, role, stat}) => {
    const roleIcons = champ.roles.map(r =>
      `<img src="${ROLE_ICON[r]}" alt="${r}" title="${r}" style="height:18px;margin-right:4px;">`
    ).join("");

    tbody.insertAdjacentHTML("beforeend", `
      <tr>
        <td>
          <img src="${champ.icon}" style="height:24px;vertical-align:middle;margin-right:6px;">
          ${champ.name}
        </td>
        <td>${roleIcons}</td>
        <td>${stat.wr}%</td>
        <td>${stat.rank1}</td>
        <td>${stat.points}</td>
      </tr>
    `);
  });
}

document.getElementById("serverSelect").addEventListener("change", e => {
  currentServer = e.target.value;
  renderTable();
});
document.getElementById("roleSelect").addEventListener("change", e => {
  currentRole = e.target.value;
  renderTable();
});

renderTable();
</script>

</body>
</html>
